pipeline {
   agent any
   tools {
       // use Matlab from Jenkins tool settings
       matlab 'Matlab R2022a'
   }
   options {
            buildDiscarder logRotator(artifactDaysToKeepStr: '3', artifactNumToKeepStr: '7', daysToKeepStr: '3', numToKeepStr: '7')
    }
    stages{
        stage('Build: Run MATLAB Commands and Scripts') {
            steps
            {
               runMATLABCommand 'ver'
               runMATLABCommand 'addpath("mScripts"), 'extract_unresolved_links'
            }       
        } 
	    stage('Run MATLAB Tests') {
            steps
            {
                runMATLABTests()
            }       
        }                 
    }
	post {
			always {
				echo 'This will always run'
			}
			success {
				echo 'This will run only if successful'
			}
			failure {
				echo 'This build failed'
				emailext body: "${env.BUILD_URL}"
				subject: 'Build failure',
				to: 'najma.javed.temp@lilium.com'
			}
			unstable {
				echo 'This will run only if the run was marked as unstable'
			}
			changed {
				echo 'This will run only if the state of the Pipeline has changed'
				echo 'For example, if the Pipeline was previously failing but is now successful'
			}
		}	
}